if(window.rcmail){rcmail.addEventListener("init",function(){rcmail.enable_command("plugin.carddav-addressbook-sync",!0);rcmail.enable_command("plugin.carddav-addressbook-sync-silent",!0);rcmail.addEventListener("plugin.carddav_addressbook_message",carddav_addressbook_message);rcmail.addEventListener("plugin.carddav_addressbook_message_silent",carddav_addressbook_message_silent);rcmail.addEventListener("plugin.carddav_addressbook_message_copied",carddav_addressbook_message_copied);rcmail.register_command("plugin.carddav-addressbook-sync",
function(){$("#carddavsyncbut").removeClass("carddavsync");$("#carddavsyncbut").addClass("carddavloading");rcmail.http_post("plugin.carddav-addressbook-sync","",rcmail.display_message(rcmail.gettext("addressbook_sync_loading","carddav"),"loading"))},!0);rcmail.register_command("plugin.carddav-addressbook-sync-silent",function(){$("#carddavsyncbut").removeClass("carddavsync");$("#carddavsyncbut").addClass("carddavloading");rcmail.http_post("plugin.carddav-addressbook-sync","_silent=1")},!0)});var carddav_addressbook_message=
function(a){$(".syncwarning").attr("title","");$(".syncwarning").removeClass("syncwarning");$("#carddavsyncbut").addClass("carddavsync");$("#carddavsyncbut").removeClass("carddavloading");if(a.check)$("li.selected").children().trigger("click"),rcmail.display_message(a.message,"confirmation");else{if(a.failure)for(var b in a.failure)$("#rcmli"+a.failure[b]).children().addClass("syncwarning"),$("#rcmli"+a.failure[b]).children().attr("title",(new Date).toLocaleString()+": "+a.message);rcmail.display_message(a.message,
"error")}},carddav_addressbook_message_silent=function(a){"addressbook"==rcmail.env.task&&($("#carddavsyncbut").addClass("carddavsync"),$("#carddavsyncbut").removeClass("carddavloading"),a.check?rcmail.display_message(a.message,"confirmation"):rcmail.display_message(a.message,"error"))},carddav_addressbook_message_copied=function(a){$("li.selected").children().trigger("click");$("#message .notice").remove();rcmail.display_message(a.message,"notice")},carddav_addressbook_trigger_sync=function(){rcmail.command("plugin.carddav-addressbook-sync-silent");
window.setTimeout("carddav_addressbook_trigger_sync()",6E4*parseInt(rcmail.env.sync_carddavs_interval))};rcmail.env.sync_carddavs_interval&&0!=parseInt(rcmail.env.sync_carddavs_interval)&&("mail"==rcmail.env.task&&""==rcmail.env.action||"addressbook"==rcmail.env.task)&&!0!=rcmail.env.framed&&$(document).ready(function(){window.setTimeout("carddav_addressbook_trigger_sync();",5E3)})};